# ìžë°”ìŠ¤í¬ë¦½íŠ¸ 13. JavaScript async ì™€ await ê·¸ë¦¬ê³  ìœ ìš©í•œ Promise APIs

async & await

// clear style of using promise

```jsx
1. async
function fetchUser() {
	// do network request in 10 secs....
	return 'ellie';
}

const user = fetchUser();
console.log(user);
// fetchUser() ì²˜ëŸ¼ ë¬´ì–¸ê°€ ì˜¤ëž˜ ê±¸ë¦¬ëŠ” ì½”ë“œë¥¼
// ë¹„ë™ê¸°ì  ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šìœ¼ë©´, JSëŠ” ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•´ë²„ë ¤ì„œ
//  do network request in 10 secs, 10ì´ˆê°„ ê±¸ë¦¬ëŠ” ì½”ë“œ ë–„ë¬¸ì— returnì´ ëŠ¦ì–´ì§

async function fetchUser() {
	// do network request in 10 secs....
	resolve 'ellie';
}
// function ì•žì— async ë¥¼ ë¶™ì—¬ì„œ Promiseë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ë¹„ë™ê¸°ì  ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìžˆìŒ

const user = fetchUser();
user.then(console.log);
console.log(user);
```

```jsx
2. await
// async ê°€ ë¶™ì€ í•¨ìˆ˜ ì•ˆì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥
function delay(ms) {
	return new Promise(resolve => setTimeout(resolve, ms)); // ì •í•´ì§„ msê°€ ì§€ë‚˜ë©´, resolveë¥¼ í˜¸ì¶œí•œë‹¤
}

async function getApple() {
	await delay(4000);
	throw 'error';
	return 'ðŸŽ';
}

async function getBanana() {
	await delay(3000);
	return 'ðŸŒ';
}
// async function getBanana() í•¨ìˆ˜ë¥¼ Promiseë¡œ ë°”ê¾¼ë‹¤ë©´â“â“
function getBanana() {
	return delay(3000)
	.then(() => 'ðŸŒ')
}

// 'ðŸŽ', 'ðŸŒ' ëª¨ë‘ ë°›ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ìž!
function pickFruits() {
	return getApple()
	.then(apple => {
		return getBanana()
		.then(banana => `${apple} + ${banana}`)
	});
}

pickFruits().then(console.log); // 'ðŸŽ' + 'ðŸŒ'

// async ë¡œ ë°”ê¾¼ë‹¤ë©´â“â“
async function pickFruits() {
	try {
		const apple = await getApple();
		const banana = await getBanana();
	} catch {

	}
	return `${apple} + ${banana}`;
}

// ìœ„ì˜ ì½”ë“œëŠ” apple ê³¼ bananaê°€ ì„œë¡œ ì—°ê´€ì´ ì—†ëŠ” ì½”ë“œì´ê¸° ë•Œë¬¸ì— ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•  í•„ìš”ê°€ ì—†ìŒ
// ë¹„ë™ê¸°ì  ì²˜ë¦¬ë¥¼ í•´ë³´ìžâ—â—
// pickFruits() í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ ë³‘ë ¬ì ìœ¼ë¡œ getApple()ê³¼ getBanana()ê°€ ë™ì‹œì— ë³‘ë ¬ì ìœ¼ë¡œ ì‹¤í–‰ë¨
async function pickFruits() {
	const applePromise = getApple();
	const bananaPromise = getBanana();
	const apple = await applePromise;
	const banana = await bananaPromise;
	return `${apple} + ${banana}`;
}
```

```jsx
3. useful Promise APIs
// Promise.all
// Promiseë¥¼ ì „ë‹¬í•˜ê²Œ ë˜ë©´ ëª¨ë“  Promise ë“¤ì´ ë³‘ë ¬ì ìœ¼ë¡œ ë‹¤ ë°›ì„ë•Œê¹Œì§€ ëª¨ì•„ì¤Œ
function pickAllFruits() {
	return new Promise.all([getApple(), getBanana()])
	// fruitsì— allì˜ ë°°ì—´ì´ ëª¨ë‘ ì „ë‹¬ ë¨
	.then(fruits => fruits.join('+')) // joinìœ¼ë¡œ ë°°ì—´ì„ stringìœ¼ë¡œ ë¬¶ì–´ì¤Œ
}
pickAllFruits().then(console.log); //

// Promise.race
// ë°°ì—´ì— ì „ë‹¬ëœ ê°’ì¤‘ ê°€ìž¥ ë¨¼ì € return ë˜ëŠ” ì¸ìžë§Œ ë°˜í™˜í•œë‹¤.
function pickOnlyOne() {
	return new Promise.race([getApple(), getBanana()]);'ðŸŽ' + 'ðŸŒ'
}
pickOnlyOne().then(console.log); // 'ðŸŒ'
```

```jsx
4. Home Work
class UserStorage {
	loginUser (id, password) {
		return new Promise((resolve, reject) => {
			setTimeout(() => {
			if(
					(id === 'ellie' && password === 'dream') ||
					(id === 'coder' && password === 'academy')
				) {
					resolve(id); // ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ resolveì— idë¥¼ ì¸ìžë¡œ ì „ë‹¬
				} else {
					reject(new Error('not found'));
				}
			}, 2000);
		});
	}

	getRoles(user) {
		return new Promise((resolve, reject) => {
			setTimeout(() => {
			if(user === 'ellie') {
				resolve({name: 'ellie', role: 'admin'});
				} else {
					reject(new Error('no access'));
				}
			}, 1000);
		});
	}
}

const userStorage = new UserStorage();
const id = prompt('enter your id');
const password = prompt('enter your password');
async function usercheck() {
	try {
		const userId= await userStorage.loginUser(id, password);
		const user = await userStorage.getRoles(user);
		alter(`Hello ${user.name}, you hava a ${user.role} role.`);
	} catch(error) {
		console.log(error)
	}
}
```
